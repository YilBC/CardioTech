APP PRIMERA VERSI칍N 



# C:\Users\yilinet.bueno\Desktop\Modelos\Estudio Medico\CardioTech>cd C:\Users\yilinet.bueno\AppData\Local\Programs\Python\Python310\python.exe app1.py
# Correr desde terminal cmd, alla si dejo instalar librerias del modelo C:\Users\yilinet.bueno\Desktop\Modelos\Estudio Medico\CardioTech>streamlit run app1.py 
# APP STREAMLIT: carga el pipeline y predice directo

import streamlit as st
import pandas as pd
from PIL import Image
import joblib
from pathlib import Path

st.set_page_config(page_title="CardioTech | RCV", layout="wide")

# ----- Cargar artefactos -----
ART = Path("artefactos_rcv_simple")
pipe = joblib.load(ART/"pipeline_modelo.joblib")
BEST_THRESHOLD = float((ART/"threshold_fijo.txt").read_text().strip())

# ---- Encabezado ----
st.title("CardioTech | Calculadora de Riesgo Cardiovascular")
#st.header("Calculadora de Riesgo Cardiovascular")
st.caption("Modelo estad칤stico para estimar probabilidad de riesgo cardiovascular.")

st.sidebar.image("LogoCardiotechfondo.png", width=200)
st.sidebar.image("bodytechfondo.png", width=200)
st.sidebar.image("BIA.png", width=200)
st.sidebar.caption("Realizado por Investigaci칩n BIA")

# Video
try:
    with open("MODELORCV2.mp4", "rb") as video_file:
                col1, col2, col3=st.columns([1, 4, 1])
                with col2:
                  st.video(video_file.read(),autoplay=True, loop=True, start_time=3, width=3000)
except FileNotFoundError:
    st.info("Video no disponible.")

with st.form("rcv"):
    nombre = st.text_input("Nombre")
    politica = st.selectbox("쮸ceptas nuestra pol칤tica de protecci칩n de datos?", ["SI","NO"])
    st.link_button("Ver Pol칤tica", "https://bodytech.com.co/poltica-de-tratamiento-de-datos-personales")

    # --- 15 variables del modelo EXACTAS, 2 calculadas ---
    genero = st.selectbox("G칠nero de nacimiento", ["Femenino","Masculino"])
    estrato = st.selectbox("Estrato", ["1","2","3","4","5","6"])    
    tipo_vinc = st.selectbox("Tipo de vinculaci칩n", ["Contributivo","Subsidiado","Vinculado","Particular ","Otro"])
    
    st.caption("Contributivo: Personas que tienen una vinculaci칩n laboral")
    st.caption("Subsidiado: Personas que no cuenten con capacidad de pago o en estado de vulnerabilidad")
    st.caption("Vinculado:  Personas con incapacidad de pago en espera de ser beneficiarios del r칠gimen subsidiado")
    st.caption("Particular: Personas con servicios personalizados con mayor cubrimiento (medicina prepagada)")

    ocupacion = st.selectbox("Ocupaci칩n", ["Profesional","Tecn칩logo/Tecnico","Bachiller"])

    sedentarismo = st.selectbox("Realizas menos de 150 minutos (2.5h) de actividad fisica a la semana?", ["SI","NO"])
    tabaquismo = st.selectbox("쮽uma actualmente?", ["SI","NO"])
    antecedente_fam = st.selectbox("쮸ntecedentes familiares de Enfermedad Cardiovascular?", ["SI","NO"])
    tipo_diagnostico=st.selectbox("Tienes alguna enfermedad Cardiaca, Renal o Diabetes diagnosticada?", ["SI","NO"])

    peso = st.number_input("Peso (kg)", min_value=5.0, max_value=300.0, step=5.0, format="%.1f")   
    talla = st.number_input("Talla (m)", min_value=0.50,max_value=2.5, step=0.5, format="%.1f")  
    mmusc = st.number_input("Porcentaje masa muscular (%)", min_value=10.0, max_value=60.0, step=3.0, format="%.1f")
    imm = ((peso*mmusc)/100)/(talla*talla)
    st.caption(f"El resultado del IMM es: {imm}")
    #imm = st.number_input("IMM", min_value=3.89,max_value=20.0, step=5.0, format="%.1f")
    fat = st.number_input("Porcentaje de grasa (%)", min_value=2.0, max_value=50.0, step=5.0, format="%.1f")
    imc = (peso/(talla*talla))
    st.caption(f"El resultado del IMC es: {imc}")
    #imc = st.number_input("IMC", min_value=14.0, max_value=55.0, step=0.1, format="%.1f")

    abd = st.number_input("Per칤metro abdominal (cm)", min_value=40, max_value=250, step=1)
    sis = st.number_input("Tensi칩n arterial sist칩lica (mmHg)", min_value=80, max_value=280, step=1)
    ses_sem = st.number_input("쮼n promedio cu치ntos d칤as a la semana entrenas?", min_value=0, max_value=7, step=1)
    mean_minentr = st.number_input("쮼n promedio cu치ntos minutos por d칤a entrenas?", min_value=0, max_value=1440, step=1)
    min_sem=(mean_minentr*ses_sem)
    st.caption(f"Minutos de entrenamiento por semana en promedio es: {min_sem}")  
    #min_sem = st.number_input("쮼n promedio cu치ntos minutos a la semana entrenas?", min_value=0, max_value=10000, step=10)

    ok = st.form_submit_button("Calcular riesgo")

#Variables del modelo 
if ok:
    fila = pd.DataFrame([{
        'imm': imm,
        'fat_percentage': fat, 
        'muscle_mass_percentage': mmusc,
        'abdominal_perimeter': int(abd),
        'tension_arte_sis': int(sis),
        'Sedentarismo': sedentarismo,  # SI/NO tal cual
        'sesiones_en_la_semana': int(ses_sem),
        'minutos_por_semana': int(min_sem), 
        'tipo_vinculacion': tipo_vinc,
        'ocupacion_validada': ocupacion,
        'Antecedente Familiar': antecedente_fam,  # SI/NO tal cual
        'imc': peso/(talla**2), 
        'Estrato': str(estrato),
        'genero': genero,
        'Tabaquismo': tabaquismo  # SI/NO tal cual
    }])

    proba = float(pipe.predict_proba(fila)[:,1][0])
    yhat = int(proba >= 0.6)

    st.markdown("---")
    col1, col2, col3 = st.columns(3)
    col1.metric("Probabilidad de Riesgo", f"{proba*100:.2f}%")
    col2.caption("Modelo estad칤stico para estimar probabilidad de riesgo cardiovascular by Bodytech.")

    if tipo_diagnostico=='SI':
        st.error(  "游댮 Riesgo **ALTO** seg칰n el modelo. Consulta medica por seguimiento a enfermedad diagnosticada.")
    elif proba>=0.8 :
        st.error(  "游댮 Riesgo **ALTO** seg칰n el modelo. Consulta m칠dica recomendada.")
    elif 0.7 <= proba < 0.8:
        st.warning("游리 Riesgo **MEDIO** seg칰n el modelo. Consulta m칠dica recomendada, mejora tus h치bitos.")
    elif 0.6 <= proba < 0.7 :
        st.warning("游릭 Riesgo **BAJO** seg칰n el modelo. Mant칠n h치bitos saludables.")
    else:
        st.success("游릭 **SIN RIESGO** seg칰n el modelo. Mant칠n h치bitos saludables.")